# R509-TP4 - ZUI

## 1 - Avant de commencer

On installe Zui et on récupère le paquet QCM1:

```sh
wget https://github.com/brimdata/zui/releases/download/v1.18.0/zui_1.18.0_amd64.deb
wget https://raw.githubusercontent.com/alexis-opolka/import-cours-but-rt/refs/heads/master/cours/modules/R509/R509-TP4/src/qcm1.tgz
```

### 1.2 - Logiciels à installer pour commencer

On installe les plugins nu:

```sh
nu
plugin add ~/.cargo/bin/nu_plugin_polars
plugin add ~/.cargo/bin/nu_plugin_query
plugin add ~/.cargo/bin/nu_plugin_formats
exit
nu
plugin list
```

## 2 - Analyse des traces réseaux du botnet Emotet à partir de fichier Zeek

### 2.1 - Analyse post mortem de traces du virus Emotet au format json

1. Affichez l’adresse ip des machines communiquant entre elles via http ainsi que les "uri"

    La commande:

    ```sh
    _path == "http" | sort -r | yield {from: id.orig_h, to:host, uri:uri}
    ```

    Ce qui nous donne:

    ```json
    [{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/v9bb0/bo2fqdsdtzorr5rep0i/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/h6qi/lb1dhp/98wzr2krwmm4/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/pvbzhhiyiti9e/izh4ca/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/c3855w62/xnfgfli41s35u295y/bm04vkz/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/xrn581egq/ur2rd8/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/h3cc0hv2llqouib8/towc8ksx/hsa6q86r7w3a6m/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/oy0zvkaaa2/q6dvsdask1pfwo2l23/l55xbprqin4b42ch/zyytv220fr237la24gi/sb7mjh/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/0ie7j/6ee132k6oio/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/8ez5ny6v9lt2j2n/8nozgtj00oz8is9k/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/ch7yy6wqvi5hxkoka/pu5xvenbb9n9r3y/j6o8wv0ruxh/kbeilbc5n8e9ep8fg/nctadq/sr2zd/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/hbwubd1ghq2/6mgzkg6dn5to/6lx9qp053kb5jhgn/m79y0m1lmpjae2ubu/s3sof/tw3dis7s2nd3awu/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/Mz0FddwPYSreH"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/titI9YcL5H"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/xqvsf/t2m11tvzqq/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/jw5cumz32djf/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/tvvzt3/ai6wn02o2/9oeb81/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/ves4up2v2n5qjq5rl/i8ldtkhnklo/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/3rkiie36/"},{"from":"10.1.6.206","to":"167.71.4.0:8080","uri":"/va9j7/5clu9bdp5xth2a/4pq9nord/hubrikuq7sd1bzouay/tx5gbulv8oa/rlvb840174dl3f/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/raet/u6tpsbdmo5g7crj4f/8l720ln/lwrl5fe38/1yje7g5qc/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/mro86v6nvs42/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/vwst360x8syxks325x/26dtqu31wzhmwqq/8p9iu8zbragj/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/ko5ezxmguvv/p8d4003oiu/utkdae7r/74uzr8n74r/"},{"from":"10.1.6.206","to":"5.2.136.90","uri":"/7u0e9j2avwlvnuynyo/szcm27k/fzb067wy/"},{"from":"10.1.6.206","to":"seo.udaipurkart.com","uri":"/rx-5700-6hnr7/Sgms/"},{"from":"10.1.6.206","to":"sarture.com","uri":"/wp-includes/JD8/"},{"from":"10.1.6.206","to":"padreescapes.com","uri":"/blog/0I/"},{"from":"10.1.6.206","to":"hangarlastik.com","uri":"/cgi-sys/suspendedpage.cgi"},{"from":"10.1.6.206","to":"hangarlastik.com","uri":"/cgi-bin/Ui4n/"}]
    ```

2. Dans le trafic http sélectionnez les communications relatives aux sites "hangarlastik.com", 
  "padreescapes.com", sarture.com et "seo.udaipurkart.com". Affichez les "IP sources" , les IP de "destinations"
  et les "uri" sur la sélection

    La commande:

    ```sh
     _path == "http" | sort -r | where host == "hangarlastik.com" | yield {from: id.orig_h, to:host}
    ```

    Ce qui nous donne:

    ```json
    [{"from":"10.1.6.206","to":"hangarlastik.com"},{"from":"10.1.6.206","to":"hangarlastik.com"}]
    ```

3. Sélectionnez les communications relatives à la ddl contenant Emotet "nDUrg8uFD5hldll" (files)
  depuis "files.log".

    La commande:

    ```sh
    filename == "nDUrg8uFD5hl.dll"
    ```

    Ce qui nous donne:

    ```json
    [{"ts":1609951345.692436,"fuid":"F7PwoN2iVHs0VOG6s2","uid":"CErdzl4eUJO04zgXIh","id.orig_h":"10.1.6.206","id.orig_p":49775,"id.resp_h":"103.92.235.25","id.resp_p":80,"source":"HTTP","depth":0,"analyzers":["PE"],"mime_type":"application/x-dosexec","filename":"nDUrg8uFD5hl.dll","duration":2.86712908744812,"local_orig":false,"is_orig":false,"seen_bytes":192000,"missing_bytes":0,"overflow_bytes":0,"timedout":false}]
    ```

4. Sélectionnez les requêtes de type "POST" sur les ports de destination 80 ou 8080

    La commande:

    ```sh
    _path == "http" | sort -r | where method == "POST" and (id.resp_p == 8080 or id.resp_p == 80) | yield {from: id.orig_h, to: id.resp_h, method: method, port: id.resp_p}
    ```

    Ce qui nous donne:

    ```json
    [{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"167.71.4.0","method":"POST","port":8080},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80},{"from":"10.1.6.206","to":"5.2.136.90","method":"POST","port":80}]
    ```

### 5.5 - Analysez le premier pcap d'Emotet à l'aide de Zui



- ```sh
  _path=="dns" | count() by query | sort -r
  ```

  ```json
  [{"query":"dns.msftncsi.com","count":7},{"query":"v10.events.data.microsoft.com","count":7},{"query":"nexusrules.officeapps.live.com","count":5},{"query":"settings-win.data.microsoft.com","count":5},{"query":"DESKTOP-USER1PC","count":3},{"query":"self.events.data.microsoft.com","count":2},{"query":"login.live.com","count":1},{"query":"fe2cr.update.microsoft.com","count":1},{"query":"hangarlastik.com","count":1},{"query":"padreescapes.com","count":1},{"query":"img-prod-cms-rt-microsoft-com.akamaized.net","count":1},{"query":"evoke-windowsservices-tas.msedge.net","count":1},{"query":"licensing.mp.microsoft.com","count":1},{"query":"sarture.com","count":1},{"query":"mrodevicemgr.officeapps.live.com","count":1},{"query":"fe3cr.delivery.mp.microsoft.com","count":1},{"query":"ocsp.verisign.com","count":1},{"query":"storeedgefd.dsx.mp.microsoft.com","count":1},{"query":"storecatalogrevocation.storequality.microsoft.com","count":1},{"query":"seo.udaipurkart.com","count":1}]
  ```

- ```sh
  _path matches smb* OR _path=="dce_rpc"
  ```

  ```json
  N/A
  ```

- ```sh
  _path=="http" | cut id.orig_h, id.resp_h, id.resp_p, method, host, uri | uniq -c
  ```

  ```json
  [{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/v9bb0/bo2fqdsdtzorr5rep0i/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/h6qi/lb1dhp/98wzr2krwmm4/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/pvbzhhiyiti9e/izh4ca/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/c3855w62/xnfgfli41s35u295y/bm04vkz/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/xrn581egq/ur2rd8/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/h3cc0hv2llqouib8/towc8ksx/hsa6q86r7w3a6m/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/oy0zvkaaa2/q6dvsdask1pfwo2l23/l55xbprqin4b42ch/zyytv220fr237la24gi/sb7mjh/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/0ie7j/6ee132k6oio/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/8ez5ny6v9lt2j2n/8nozgtj00oz8is9k/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/ch7yy6wqvi5hxkoka/pu5xvenbb9n9r3y/j6o8wv0ruxh/kbeilbc5n8e9ep8fg/nctadq/sr2zd/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/hbwubd1ghq2/6mgzkg6dn5to/6lx9qp053kb5jhgn/m79y0m1lmpjae2ubu/s3sof/tw3dis7s2nd3awu/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/Mz0FddwPYSreH"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/titI9YcL5H"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/xqvsf/t2m11tvzqq/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/jw5cumz32djf/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/tvvzt3/ai6wn02o2/9oeb81/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/ves4up2v2n5qjq5rl/i8ldtkhnklo/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/raet/u6tpsbdmo5g7crj4f/8l720ln/lwrl5fe38/1yje7g5qc/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/3rkiie36/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/mro86v6nvs42/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"167.71.4.0","resp_p":8080},"method":"POST","host":"167.71.4.0:8080","uri":"/va9j7/5clu9bdp5xth2a/4pq9nord/hubrikuq7sd1bzouay/tx5gbulv8oa/rlvb840174dl3f/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/vwst360x8syxks325x/26dtqu31wzhmwqq/8p9iu8zbragj/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/ko5ezxmguvv/p8d4003oiu/utkdae7r/74uzr8n74r/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"5.2.136.90","resp_p":80},"method":"POST","host":"5.2.136.90","uri":"/7u0e9j2avwlvnuynyo/szcm27k/fzb067wy/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"103.92.235.25","resp_p":80},"method":"GET","host":"seo.udaipurkart.com","uri":"/rx-5700-6hnr7/Sgms/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"173.255.195.246","resp_p":80},"method":"GET","host":"sarture.com","uri":"/wp-includes/JD8/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"66.153.205.191","resp_p":80},"method":"GET","host":"padreescapes.com","uri":"/blog/0I/"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"89.252.164.58","resp_p":80},"method":"GET","host":"hangarlastik.com","uri":"/cgi-sys/suspendedpage.cgi"},"count":1},{"value":{"id":{"orig_h":"10.1.6.206","resp_h":"89.252.164.58","resp_p":80},"method":"GET","host":"hangarlastik.com","uri":"/cgi-bin/Ui4n/"},"count":1}]
  ```

- ```sh
  _path=="conn" | cut id.orig_h, id.resp_p, id.resp_h | sort | uniq
  ```

  ```json
  [{"id":{"orig_h":"10.1.6.206","resp_p":53,"resp_h":"10.1.6.1"}},{"id":{"orig_h":"10.1.6.206","resp_p":80,"resp_h":"5.2.136.90"}},{"id":{"orig_h":"10.1.6.206","resp_p":80,"resp_h":"103.92.235.25"}},{"id":{"orig_h":"10.1.6.206","resp_p":80,"resp_h":"173.255.195.246"}},{"id":{"orig_h":"10.1.6.206","resp_p":80,"resp_h":"66.153.205.191"}},{"id":{"orig_h":"10.1.6.206","resp_p":80,"resp_h":"89.252.164.58"}},{"id":{"orig_h":"10.1.6.206","resp_p":137,"resp_h":"10.1.6.255"}},{"id":{"orig_h":"10.1.6.206","resp_p":138,"resp_h":"10.1.6.255"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.8.20"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.8.20"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.128.71"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.185.211.133"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.230.222.68"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.242.211.89"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.75.79"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"168.62.200.169"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.183.220.149"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.8.30"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.230.222.68"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.242.211.89"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"138.91.136.108"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.88.34"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.230.222.68"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"13.107.5.88"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.185.211.133"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.76.30"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.242.211.89"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.88.20"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.230.222.68"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"23.206.125.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"23.67.246.17"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"104.95.94.118"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.183.220.149"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"40.91.76.238"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"40.126.5.36"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.88.21"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.8.21"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.132.91"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"46.101.230.194"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.109.8.21"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.77.33"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"111.221.29.40"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.77.33"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"20.188.78.185"}},{"id":{"orig_h":"10.1.6.206","resp_p":443,"resp_h":"52.114.132.91"}},{"id":{"orig_h":"10.1.6.206","resp_p":1900,"resp_h":"239.255.255.250"}},{"id":{"orig_h":"10.1.6.206","resp_p":8080,"resp_h":"167.71.4.0"}}]
  ```

- ```sh
  filename!=null | cut _path, tx_hosts, rx_hosts, conn_uids, mime_type, filename, md5, sha1
  ```

  ```json
  [{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"JnaOsBXPi","md5":"eb748de4d01f457786ab6a581a84d703","sha1":"d05bb967b6ffd0d56db73d2d27d31ae75e93091d"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"NuecW","md5":"ddb12945e3e51a6a498cc112d56d47e2","sha1":"a1e919b53e1124538dc1441cf9a2717540ab8737"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"vSAIMfat","md5":"cd8e2cafe7a10d69bca3c2bff715b354","sha1":"a9aa158d9d31bef6cd65c8d3c74c7cf1dc6f731e"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"TZPrAQV","md5":"5a38b5e9d509dc860425d6e886d7b096","sha1":"673299ae14a7eb201d260f866d693e899f40eb92"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"iCbGlvmAHfmoBBAQOe","md5":"9ebb352c70655c3e7aee0aba88d9b36f","sha1":"6678efbf613df3d0e212455d736beacd5e5dd42c"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"SWyQwPmoTVsb","md5":"41311f69fb4c8f7ddec968aef1eb68b4","sha1":"9b00b7da5536a8714ddec022b6ad3fe70c3d6b9d"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"HfWwDcgoUXIoxiZAW","md5":"d7b3ba65b74ae77931cc78cd7f2133fe","sha1":"aaf443aa805c70411a30cd90fe6c163c660274ab"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"HePABOKqF","md5":"f418525418ff1da2fbe7a088fa373fdc","sha1":"f6250971ded468504d642c5cf35d8876d6289ce1"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"oyklDtUrTcoLxSgNne","md5":"6c574084e1a2d9460723a06f42abd25d","sha1":"51590d9c603e5c191ceea909247f6ffd8e7796fd"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"CHhgtNvmDtYpewojhpL","md5":"9efdcaa4fdb596bf71beaa69f5c133f2","sha1":"9a636104374939a7a417ed2ec296045f04a89772"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"TLzRVCkCG","md5":"8f9c5db7412cbccf65fd187bea2e2beb","sha1":"58c06bbfb7931bdf8a515001a0ec8cf638b9bf09"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"CwsAfvyHAFbsmePzfi","md5":"ead9a7844cdfce1b7d45d00c6bbf6969","sha1":"88ad421a2b7aca7f9a599eb5101895dac15d39e8"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"DgQFRjTPGisRxjaBAB","md5":"e5029884f01f8eb2f72b7cd8c365e55a","sha1":"b70e74c5e074100335520951f731389ee0035690"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"cdOGZQLfeEMK","md5":"7833431d4ec309b8b134b82708229124","sha1":"753df1c04fc8aea3cad51aab7709c1f08a981765"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"EWssmhDfyddeu","md5":"03a18196601d27e6042481ac9740d0ce","sha1":"e1fefb948130550949b20135da38c26f9a89417e"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"HNmSIHcQqiuDjyl","md5":"fbdf24209bdb2a585e6866b597d6bbe6","sha1":"42dfffe33d532a82dd0569beea872d5b5253ed1d"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"kXOTfAOkPBC","md5":"d6c7d5ddb4b92aefc7fdd4e4233afd8a","sha1":"b0121dc024a264769c699fb5d0e6146781691a77"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"qzLwsgh","md5":"6f251f3710431657f2e8ad7a428d6960","sha1":"c636f9df8b2dc00930b4be5b42468d2c79d38b0f"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"uHiSDbGlMRSittptMyq","md5":"e1de80fd327169329816ad84d8f31d50","sha1":"b0d58953ebe9046be6e08235dc8398e8063299b7"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"YJOjLXCTqhWyWCU","md5":"f4c4e6a08217918b4a8b1192ffad3d5e","sha1":"f869014757022636bb5817a1f689c5cb9d6542a1"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"NyhdNgYAMkJTEH","md5":"c30f6cfb212ae1a58454e024fdb327d8","sha1":"2f81f65651cb44f1e9a687e33c0bd1feb1fc4610"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":null,"filename":"iVOWebWBCLKvFqxScD","md5":"e0f96724a94521b11606b9a354c9d7aa","sha1":"da3a538028418b62fff11568ca8a67a5ba39fe73"},{"_path":"files","tx_hosts":{"error":"missing"},"rx_hosts":{"error":"missing"},"conn_uids":{"error":"missing"},"mime_type":"application/x-dosexec","filename":"nDUrg8uFD5hl.dll","md5":"66915ad966c1da73aa5d552df6313084","sha1":"8aed7ff9163004e657f5d2a4e6223698e18124a9"}]
  ```

- ```sh
  method=="POST" | cut ts, uid, id, method, uri, status_code
  ```

  ```json
  [{"ts":"2021-01-06T18:17:34.216805Z","uid":"C9CMSM2D3E1J0UC56a","id":{"orig_h":"10.1.6.206","orig_p":49845,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/v9bb0/bo2fqdsdtzorr5rep0i/","status_code":200},{"ts":"2021-01-06T18:17:31.856274Z","uid":"C9CMSM2D3E1J0UC56a","id":{"orig_h":"10.1.6.206","orig_p":49845,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/h6qi/lb1dhp/98wzr2krwmm4/","status_code":200},{"ts":"2021-01-06T18:17:27.869619Z","uid":"C20i0Cpj3KACn42j7","id":{"orig_h":"10.1.6.206","orig_p":49840,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/pvbzhhiyiti9e/izh4ca/","status_code":200},{"ts":"2021-01-06T18:17:24.74148Z","uid":"C20i0Cpj3KACn42j7","id":{"orig_h":"10.1.6.206","orig_p":49840,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/c3855w62/xnfgfli41s35u295y/bm04vkz/","status_code":200},{"ts":"2021-01-06T18:17:20.408858Z","uid":"C20i0Cpj3KACn42j7","id":{"orig_h":"10.1.6.206","orig_p":49840,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/xrn581egq/ur2rd8/","status_code":200},{"ts":"2021-01-06T18:01:35.612124Z","uid":"CBwMwx2IwElj7ZM6Aa","id":{"orig_h":"10.1.6.206","orig_p":49837,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/h3cc0hv2llqouib8/towc8ksx/hsa6q86r7w3a6m/","status_code":200},{"ts":"2021-01-06T17:45:43.082855Z","uid":"CChkdL3vGeEx2peAL6","id":{"orig_h":"10.1.6.206","orig_p":49835,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/oy0zvkaaa2/q6dvsdask1pfwo2l23/l55xbprqin4b42ch/zyytv220fr237la24gi/sb7mjh/","status_code":200},{"ts":"2021-01-06T17:30:26.501639Z","uid":"CTm5UX2QMUBJa7I8Ck","id":{"orig_h":"10.1.6.206","orig_p":49824,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/0ie7j/6ee132k6oio/","status_code":200},{"ts":"2021-01-06T17:14:16.066352Z","uid":"C75sDX2Nxft76m6vgl","id":{"orig_h":"10.1.6.206","orig_p":49822,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/8ez5ny6v9lt2j2n/8nozgtj00oz8is9k/","status_code":200},{"ts":"2021-01-06T17:14:09.057976Z","uid":"ClkuUf0Y2JhKKd4lb","id":{"orig_h":"10.1.6.206","orig_p":49819,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/ch7yy6wqvi5hxkoka/pu5xvenbb9n9r3y/j6o8wv0ruxh/kbeilbc5n8e9ep8fg/nctadq/sr2zd/","status_code":200},{"ts":"2021-01-06T17:14:04.879412Z","uid":"ClkuUf0Y2JhKKd4lb","id":{"orig_h":"10.1.6.206","orig_p":49819,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/hbwubd1ghq2/6mgzkg6dn5to/6lx9qp053kb5jhgn/m79y0m1lmpjae2ubu/s3sof/tw3dis7s2nd3awu/","status_code":200},{"ts":"2021-01-06T16:58:48.263972Z","uid":"CllcG3147FXbM4lIfb","id":{"orig_h":"10.1.6.206","orig_p":49815,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/Mz0FddwPYSreH","status_code":200},{"ts":"2021-01-06T16:58:43.651308Z","uid":"CqIdz8pwXFEoCMMV5","id":{"orig_h":"10.1.6.206","orig_p":49814,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/titI9YcL5H","status_code":200},{"ts":"2021-01-06T16:58:38.249579Z","uid":"CtuVip4LR6LkjFXPrc","id":{"orig_h":"10.1.6.206","orig_p":49812,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/xqvsf/t2m11tvzqq/","status_code":200},{"ts":"2021-01-06T16:58:34.969012Z","uid":"CtuVip4LR6LkjFXPrc","id":{"orig_h":"10.1.6.206","orig_p":49812,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/jw5cumz32djf/","status_code":200},{"ts":"2021-01-06T16:43:00.401374Z","uid":"CHEd9Z2QE8BoCj1Qj4","id":{"orig_h":"10.1.6.206","orig_p":49794,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/tvvzt3/ai6wn02o2/9oeb81/","status_code":200},{"ts":"2021-01-06T16:42:56.629473Z","uid":"CM2Z922vgHJNPxUQW6","id":{"orig_h":"10.1.6.206","orig_p":49793,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/ves4up2v2n5qjq5rl/i8ldtkhnklo/","status_code":200},{"ts":"2021-01-06T16:42:52.994985Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/raet/u6tpsbdmo5g7crj4f/8l720ln/lwrl5fe38/1yje7g5qc/","status_code":200},{"ts":"2021-01-06T16:42:52.314705Z","uid":"CcVyMqn0zxWCU80F1","id":{"orig_h":"10.1.6.206","orig_p":49790,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/3rkiie36/","status_code":200},{"ts":"2021-01-06T16:42:49.977467Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/mro86v6nvs42/","status_code":200},{"ts":"2021-01-06T16:42:48.469906Z","uid":"CkmTje1Hc3LklbarFa","id":{"orig_h":"10.1.6.206","orig_p":49788,"resp_h":"167.71.4.0","resp_p":8080},"method":"POST","uri":"/va9j7/5clu9bdp5xth2a/4pq9nord/hubrikuq7sd1bzouay/tx5gbulv8oa/rlvb840174dl3f/","status_code":200},{"ts":"2021-01-06T16:42:45.748498Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/vwst360x8syxks325x/26dtqu31wzhmwqq/8p9iu8zbragj/","status_code":200},{"ts":"2021-01-06T16:42:42.022311Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/ko5ezxmguvv/p8d4003oiu/utkdae7r/74uzr8n74r/","status_code":200},{"ts":"2021-01-06T16:42:34.805404Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"method":"POST","uri":"/7u0e9j2avwlvnuynyo/szcm27k/fzb067wy/","status_code":200}]
  ```

- ```sh
  _path=="conn" | put classnet := network_of(id.resp_h) | cut classnet | count() by classnet | sort -r
  ```

  ```json
  [{"classnet":"10.0.0.0/8","count":45},{"classnet":"46.0.0.0/8","count":40},{"classnet":"52.0.0.0/8","count":27},{"classnet":"167.71.0.0/16","count":19},{"classnet":"5.0.0.0/8","count":13},{"classnet":"40.0.0.0/8","count":2},{"classnet":"239.255.255.0/24","count":2},{"classnet":"23.0.0.0/8","count":2},{"classnet":"89.0.0.0/8","count":1},{"classnet":"103.0.0.0/8","count":1},{"classnet":"138.91.0.0/16","count":1},{"classnet":"168.62.0.0/16","count":1},{"classnet":"111.0.0.0/8","count":1},{"classnet":"104.0.0.0/8","count":1},{"classnet":"20.0.0.0/8","count":1},{"classnet":"13.0.0.0/8","count":1},{"classnet":"173.255.0.0/16","count":1},{"classnet":"66.0.0.0/8","count":1}]
  ```


- ```sh
  event_type=="alert" | count() by alert.severity,alert.category | sort count
  ```

  ```json
  [{"alert":{"severity":1,"category":"Potential Corporate Privacy Violation"},"count":1},{"alert":{"severity":2,"category":"Potentially Bad Traffic"},"count":1},{"alert":{"severity":3,"category":"Misc activity"},"count":2}]
  ```

- ```sh
  event_type=="alert" | alerts := union(alert.category) by src_ip, dest_ip
  ```

  ```json
  [{"src_ip":"103.92.235.25","dest_ip":"10.1.6.206","alerts":["Misc activity","Potentially Bad Traffic","Potential Corporate Privacy Violation"]}]
  ```

- ```sh
  event_type=="alert" | alerts := union(alert.category) by network_of(dest_ip)
  ```

  ```json
  [{"network_of":"10.0.0.0/8","alerts":["Misc activity","Potentially Bad Traffic","Potential Corporate Privacy Violation"]}]
  ```

1. Retrouver le "GET" sur "seo.udaipurkat.com" et le nom de la librairie "dll" téléchargée en réponse
  au post. Regardez la corrélation que trouve Zui avec "files" et les alertes Suricata. Ouvrez la sélection
  dans wireshark depuis Zui

  ```sh
  _path=="http" | sort -r | where host == "seo.udaipurkart.com"
  ```

  nous donne:

  ```json
  [{"_path":"http","ts":"2021-01-06T16:41:18.107407Z","uid":"CgWlVM3tcZqLyAs3Xl","id":{"orig_h":"10.1.6.206","orig_p":49775,"resp_h":"103.92.235.25","resp_p":80},"trans_depth":1,"method":"GET","host":"seo.udaipurkart.com","uri":"/rx-5700-6hnr7/Sgms/","referrer":null,"version":"1.1","user_agent":null,"origin":null,"request_body_len":0,"response_body_len":192000,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":null,"orig_filenames":null,"orig_mime_types":null,"resp_fuids":["F7PwoN2iVHs0VOG6s2"],"resp_filenames":["nDUrg8uFD5hl.dll"],"resp_mime_types":["application/x-dosexec"]}]
  ```


2. Depuis Zui lancez WireShark pour en extraire la dll

  ```sh
  _path == "files" | id.resp_h == 103.92.235.25
  ```

  nous donne:

  ```json
  [{"_path":"files","ts":"2021-01-06T16:42:25.692436Z","fuid":"F7PwoN2iVHs0VOG6s2","uid":"CgWlVM3tcZqLyAs3Xl","id":{"orig_h":"10.1.6.206","orig_p":49775,"resp_h":"103.92.235.25","resp_p":80},"source":"HTTP","depth":0,"analyzers":["PE","MD5","SHA1"],"mime_type":"application/x-dosexec","filename":"nDUrg8uFD5hl.dll","duration":"2.867129s","local_orig":false,"is_orig":false,"seen_bytes":192000,"total_bytes":null,"missing_bytes":0,"overflow_bytes":0,"timedout":false,"parent_fuid":null,"md5":"66915ad966c1da73aa5d552df6313084","sha1":"8aed7ff9163004e657f5d2a4e6223698e18124a9","sha256":null,"extracted":null,"extracted_cutoff":null,"extracted_size":null}]
  ```

  Pour des raisons de sécurité, je n'exporterai pas la DLL sur le dépôt Github mais on peut exporter le fichier réseau comme ceci:

  ![dll-exported](./src/img/dll-exported.png)

3. Retrouvez les requêtes relatives au traffic "C2" (Control & Command).
  En extraire les réseaux qui hébergent les "C2".

  Suivant cet article Medium, [disponible ici](https://bl7ck0ut.medium.com/bossfight-1-analyzing-emotet-c2-traffic-using-wireshark-11223e03fa4e), nous pouvons concentrer notre
  sur du flux HTTP:

  ```sh
  _path == "http" | where method == "POST"
  ```

  nous donne:

  ```json
  [{"_path":"http","ts":"2021-01-06T18:17:34.216805Z","uid":"C9CMSM2D3E1J0UC56a","id":{"orig_h":"10.1.6.206","orig_p":49845,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":2,"method":"POST","host":"167.71.4.0:8080","uri":"/v9bb0/bo2fqdsdtzorr5rep0i/","referrer":"167.71.4.0/v9bb0/bo2fqdsdtzorr5rep0i/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":31702,"response_body_len":2484,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FupsgY25iJNRcLztcc"],"orig_filenames":["JnaOsBXPi"],"orig_mime_types":null,"resp_fuids":["FoROMj22GaHheQAUEk"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T18:17:31.856274Z","uid":"C9CMSM2D3E1J0UC56a","id":{"orig_h":"10.1.6.206","orig_p":49845,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/h6qi/lb1dhp/98wzr2krwmm4/","referrer":"167.71.4.0/h6qi/lb1dhp/98wzr2krwmm4/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7926,"response_body_len":3860,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FqlVUd4x2wPS2sZacf"],"orig_filenames":["NuecW"],"orig_mime_types":null,"resp_fuids":["FbkE0V1Rlmvm5Q4bSa"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T18:17:27.869619Z","uid":"C20i0Cpj3KACn42j7","id":{"orig_h":"10.1.6.206","orig_p":49840,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":3,"method":"POST","host":"5.2.136.90","uri":"/pvbzhhiyiti9e/izh4ca/","referrer":"5.2.136.90/pvbzhhiyiti9e/izh4ca/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7174,"response_body_len":3364,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FaJtwg224pXsjVRPXl"],"orig_filenames":["vSAIMfat"],"orig_mime_types":null,"resp_fuids":["FGuL0U2jFwnbE7pumg"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T18:17:24.74148Z","uid":"C20i0Cpj3KACn42j7","id":{"orig_h":"10.1.6.206","orig_p":49840,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":2,"method":"POST","host":"5.2.136.90","uri":"/c3855w62/xnfgfli41s35u295y/bm04vkz/","referrer":"5.2.136.90/c3855w62/xnfgfli41s35u295y/bm04vkz/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7126,"response_body_len":304852,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FrvgnmpzxswDEHxLe"],"orig_filenames":["TZPrAQV"],"orig_mime_types":null,"resp_fuids":["F5KXe32IHb7G5xOHP4"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T18:17:20.408858Z","uid":"C20i0Cpj3KACn42j7","id":{"orig_h":"10.1.6.206","orig_p":49840,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/xrn581egq/ur2rd8/","referrer":"5.2.136.90/xrn581egq/ur2rd8/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":8582,"response_body_len":286884,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FEX7vpSv6ltwupBt6"],"orig_filenames":["iCbGlvmAHfmoBBAQOe"],"orig_mime_types":null,"resp_fuids":["FtBblD2u6vp6yqVzPf"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T18:01:35.612124Z","uid":"CBwMwx2IwElj7ZM6Aa","id":{"orig_h":"10.1.6.206","orig_p":49837,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/h3cc0hv2llqouib8/towc8ksx/hsa6q86r7w3a6m/","referrer":"5.2.136.90/h3cc0hv2llqouib8/towc8ksx/hsa6q86r7w3a6m/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":6710,"response_body_len":2644,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FmekKt41k12N43PSkj"],"orig_filenames":["SWyQwPmoTVsb"],"orig_mime_types":null,"resp_fuids":["FGHtee3WZgv40VeyVc"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T17:45:43.082855Z","uid":"CChkdL3vGeEx2peAL6","id":{"orig_h":"10.1.6.206","orig_p":49835,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/oy0zvkaaa2/q6dvsdask1pfwo2l23/l55xbprqin4b42ch/zyytv220fr237la24gi/sb7mjh/","referrer":"5.2.136.90/oy0zvkaaa2/q6dvsdask1pfwo2l23/l55xbprqin4b42ch/zyytv220fr237la24gi/sb7mjh/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":6598,"response_body_len":1428,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FQ4oGp2XSjXy9BR078"],"orig_filenames":["HfWwDcgoUXIoxiZAW"],"orig_mime_types":null,"resp_fuids":["FlvOUMn45w0SyAuQ8"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T17:30:26.501639Z","uid":"CTm5UX2QMUBJa7I8Ck","id":{"orig_h":"10.1.6.206","orig_p":49824,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/0ie7j/6ee132k6oio/","referrer":"5.2.136.90/0ie7j/6ee132k6oio/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":8694,"response_body_len":2500,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FG6NP83dU2Uxt4PNm8"],"orig_filenames":["HePABOKqF"],"orig_mime_types":null,"resp_fuids":["FZ5lUk1imgtPkS9b73"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T17:14:16.066352Z","uid":"C75sDX2Nxft76m6vgl","id":{"orig_h":"10.1.6.206","orig_p":49822,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/8ez5ny6v9lt2j2n/8nozgtj00oz8is9k/","referrer":"167.71.4.0/8ez5ny6v9lt2j2n/8nozgtj00oz8is9k/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":30262,"response_body_len":1588,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FR5Rlg3rMrADNnpy7h"],"orig_filenames":["oyklDtUrTcoLxSgNne"],"orig_mime_types":null,"resp_fuids":["FYvXBE2iHeYr1Dmzhi"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T17:14:09.057976Z","uid":"ClkuUf0Y2JhKKd4lb","id":{"orig_h":"10.1.6.206","orig_p":49819,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":2,"method":"POST","host":"5.2.136.90","uri":"/ch7yy6wqvi5hxkoka/pu5xvenbb9n9r3y/j6o8wv0ruxh/kbeilbc5n8e9ep8fg/nctadq/sr2zd/","referrer":"5.2.136.90/ch7yy6wqvi5hxkoka/pu5xvenbb9n9r3y/j6o8wv0ruxh/kbeilbc5n8e9ep8fg/nctadq/sr2zd/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":8438,"response_body_len":1284,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FTC0edydZTZizEy5i"],"orig_filenames":["CHhgtNvmDtYpewojhpL"],"orig_mime_types":null,"resp_fuids":["FYXWiyFmlBy2S42Ja"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T17:14:04.879412Z","uid":"ClkuUf0Y2JhKKd4lb","id":{"orig_h":"10.1.6.206","orig_p":49819,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/hbwubd1ghq2/6mgzkg6dn5to/6lx9qp053kb5jhgn/m79y0m1lmpjae2ubu/s3sof/tw3dis7s2nd3awu/","referrer":"5.2.136.90/hbwubd1ghq2/6mgzkg6dn5to/6lx9qp053kb5jhgn/m79y0m1lmpjae2ubu/s3sof/tw3dis7s2nd3awu/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7094,"response_body_len":306116,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FHA7dd4oHwZk9POaa8"],"orig_filenames":["TLzRVCkCG"],"orig_mime_types":null,"resp_fuids":["F4SEzneCJlP6XfDMi"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:58:48.263972Z","uid":"CllcG3147FXbM4lIfb","id":{"orig_h":"10.1.6.206","orig_p":49815,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/Mz0FddwPYSreH","referrer":"http://167.71.4.0/Mz0FddwPYSreH","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":278,"response_body_len":148,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FAIiqFyEHptI1QlT7"],"orig_filenames":null,"orig_mime_types":["text/plain"],"resp_fuids":["FclGoa471Dm3yiL3U5"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:58:43.651308Z","uid":"CqIdz8pwXFEoCMMV5","id":{"orig_h":"10.1.6.206","orig_p":49814,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/titI9YcL5H","referrer":"http://167.71.4.0/titI9YcL5H","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":225,"response_body_len":148,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FMsj963RIAuUlweMh4"],"orig_filenames":null,"orig_mime_types":["text/plain"],"resp_fuids":["FmokwR1COTB3B6AS"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:58:38.249579Z","uid":"CtuVip4LR6LkjFXPrc","id":{"orig_h":"10.1.6.206","orig_p":49812,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":2,"method":"POST","host":"5.2.136.90","uri":"/xqvsf/t2m11tvzqq/","referrer":"5.2.136.90/xqvsf/t2m11tvzqq/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":8390,"response_body_len":1988,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["Ftctyv1WAQtiDQT8c6"],"orig_filenames":["CwsAfvyHAFbsmePzfi"],"orig_mime_types":null,"resp_fuids":["FOaI7h3JOunNaJEUxd"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:58:34.969012Z","uid":"CtuVip4LR6LkjFXPrc","id":{"orig_h":"10.1.6.206","orig_p":49812,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/jw5cumz32djf/","referrer":"5.2.136.90/jw5cumz32djf/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7846,"response_body_len":235604,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FRizLA3kqpAyLMnSHb"],"orig_filenames":["DgQFRjTPGisRxjaBAB"],"orig_mime_types":null,"resp_fuids":["FWjTZJ2g11HLFwPTVl"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:43:00.401374Z","uid":"CHEd9Z2QE8BoCj1Qj4","id":{"orig_h":"10.1.6.206","orig_p":49794,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/tvvzt3/ai6wn02o2/9oeb81/","referrer":"167.71.4.0/tvvzt3/ai6wn02o2/9oeb81/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7430,"response_body_len":3476,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FUEYT01swkxtrjnNQg"],"orig_filenames":["cdOGZQLfeEMK"],"orig_mime_types":null,"resp_fuids":["Fn1y3c4uAz1KPcXW0a"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:56.629473Z","uid":"CM2Z922vgHJNPxUQW6","id":{"orig_h":"10.1.6.206","orig_p":49793,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/ves4up2v2n5qjq5rl/i8ldtkhnklo/","referrer":"167.71.4.0/ves4up2v2n5qjq5rl/i8ldtkhnklo/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":6166,"response_body_len":1940,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FrlGx61maz7dnyZkMd"],"orig_filenames":["EWssmhDfyddeu"],"orig_mime_types":null,"resp_fuids":["FLYZm2c9nTJ5YWii"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:52.994985Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":5,"method":"POST","host":"5.2.136.90","uri":"/raet/u6tpsbdmo5g7crj4f/8l720ln/lwrl5fe38/1yje7g5qc/","referrer":"5.2.136.90/raet/u6tpsbdmo5g7crj4f/8l720ln/lwrl5fe38/1yje7g5qc/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":6230,"response_body_len":1172,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FwDnoS3IYtb3kfjBhh"],"orig_filenames":["HNmSIHcQqiuDjyl"],"orig_mime_types":null,"resp_fuids":["FDuXok3U88iL5gT5Ij"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:52.314705Z","uid":"CcVyMqn0zxWCU80F1","id":{"orig_h":"10.1.6.206","orig_p":49790,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/3rkiie36/","referrer":"167.71.4.0/3rkiie36/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":4358,"response_body_len":1460,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FYSY0A2kHb4utU21Hh"],"orig_filenames":["kXOTfAOkPBC"],"orig_mime_types":null,"resp_fuids":["FOp38X1H15kaZd6Ycj"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:49.977467Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":4,"method":"POST","host":"5.2.136.90","uri":"/mro86v6nvs42/","referrer":"5.2.136.90/mro86v6nvs42/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":6278,"response_body_len":287012,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["F8vuNh3ptzshBJwPw5"],"orig_filenames":["qzLwsgh"],"orig_mime_types":null,"resp_fuids":["FsVY0sBNS0RyFWK55"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:48.469906Z","uid":"CkmTje1Hc3LklbarFa","id":{"orig_h":"10.1.6.206","orig_p":49788,"resp_h":"167.71.4.0","resp_p":8080},"trans_depth":1,"method":"POST","host":"167.71.4.0:8080","uri":"/va9j7/5clu9bdp5xth2a/4pq9nord/hubrikuq7sd1bzouay/tx5gbulv8oa/rlvb840174dl3f/","referrer":"167.71.4.0/va9j7/5clu9bdp5xth2a/4pq9nord/hubrikuq7sd1bzouay/tx5gbulv8oa/rlvb840174dl3f/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":31958,"response_body_len":3348,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["F5zskC1TD42YqxIyWa"],"orig_filenames":["uHiSDbGlMRSittptMyq"],"orig_mime_types":null,"resp_fuids":["FSZjkt4AylfRpMMQ34"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:45.748498Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":3,"method":"POST","host":"5.2.136.90","uri":"/vwst360x8syxks325x/26dtqu31wzhmwqq/8p9iu8zbragj/","referrer":"5.2.136.90/vwst360x8syxks325x/26dtqu31wzhmwqq/8p9iu8zbragj/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":8214,"response_body_len":473908,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FYaldg1JYa11cOBei"],"orig_filenames":["YJOjLXCTqhWyWCU"],"orig_mime_types":null,"resp_fuids":["FoNDxZ3lGCLGrBdTJh"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:42.022311Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":2,"method":"POST","host":"5.2.136.90","uri":"/ko5ezxmguvv/p8d4003oiu/utkdae7r/74uzr8n74r/","referrer":"5.2.136.90/ko5ezxmguvv/p8d4003oiu/utkdae7r/74uzr8n74r/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":7558,"response_body_len":411556,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FHPOuh2TVJgp3pJq3j"],"orig_filenames":["NyhdNgYAMkJTEH"],"orig_mime_types":null,"resp_fuids":["FOKNaz1g8KecRiTWhi"],"resp_filenames":null,"resp_mime_types":null},{"_path":"http","ts":"2021-01-06T16:42:34.805404Z","uid":"CnCEPn5TUU8kMy1v7","id":{"orig_h":"10.1.6.206","orig_p":49783,"resp_h":"5.2.136.90","resp_p":80},"trans_depth":1,"method":"POST","host":"5.2.136.90","uri":"/7u0e9j2avwlvnuynyo/szcm27k/fzb067wy/","referrer":"5.2.136.90/7u0e9j2avwlvnuynyo/szcm27k/fzb067wy/","version":"1.1","user_agent":"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)","origin":null,"request_body_len":6086,"response_body_len":306596,"status_code":200,"status_msg":"OK","info_code":null,"info_msg":null,"tags":[],"username":null,"password":null,"proxied":null,"orig_fuids":["FZLrmN1Yfib3JXC6T6"],"orig_filenames":["iVOWebWBCLKvFqxScD"],"orig_mime_types":null,"resp_fuids":["FM9Psl4fUa9gBZCQQh"],"resp_filenames":null,"resp_mime_types":null}]
  ```

## 3 - Défacement d’un site web par une vilaine grenouille

1. Donnez la commande zql (langage de Zui) permettant de trouvez l’IP de l’attaquant

  ```sh
  host == "www.pwned.se" | yield {attacker: id.orig_h} | uniq
  ```

  nous donne:

  ```json
  [{"attacker":"217.195.49.146"}]
  ```

2. Quelle est l’IP du second attaquant et quel outil a-t-il utilisé ? a-t-il réussi ?

60.173.9.184

3. Comment l’attaquant a-t-il procédé ?
4. Quelle est la CVE utilisée par l’attaquant ?
5. Quel type d’alerte Suricata permet de visualiser les outils de l’attaquant ? Suivez les flux.
6. Sur quel port le "phpshell" de l’attaquant est -il accessible ?
7. Quel est le nom du phpshell de l’attaquant ?
8. Ned et Homer ont-ils un compte sur la machine compromise ?